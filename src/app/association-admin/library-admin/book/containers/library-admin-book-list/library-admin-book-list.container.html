<p-toast />
<p-confirmpopup />
<p-drawer header="Right Drawer" [(visible)]="editing" position="right">
  <p>
    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore
    et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut
    aliquip ex ea commodo consequat.
  </p>
</p-drawer>
<p-panel>
  <p-menu #menu [model]="editionMenu" [popup]="true" />
  <ng-template #icons>
    <p-button icon="pi pi-plus-circle" severity="secondary" routerLink="{{routerLink}}" [disabled]="!createPermission"
      aria-label="Nuevo libro" [attr.aria-disabled]="!createPermission" rounded text />
    <p-button icon="pi pi-file-excel" [disabled]="loadingExcel" (click)="downloadExcel()" aria-label="Descargar excel"
      [attr.aria-disabled]="loadingExcel" severity="secondary" rounded text />
  </ng-template>
  <select [disabled]="loading" class="form-select form-select-sm" aria-label="Filter person status"
    (change)="onChangeSource($event)">
    <option [selected]="source === 'games'" value="games">Juegos</option>
    <option [selected]="source === 'fiction'" value="fiction">Ficción</option>
  </select>
  <p-table lazy="true" dataKey="number" selectionMode="single" [loading]="loading" [value]="data.content"
    [(selection)]="selectedData" paginator="true" [rows]="data.size" [totalRecords]="data.totalElements" [first]="first"
    (onSort)="onChangeDirection($event)" (onPage)="onPageChange($event)" showCurrentPageReport="true"
    currentPageReportTemplate="Total: {totalRecords}" (onRowSelect)="onSelectRow()">
    <ng-template #header>
      <tr>
        <th pSortableColumn="title">Título <p-sortIcon field="title" /></th>
        <th pSortableColumn="lent">Estado <p-sortIcon field="lent" /></th>
        <th></th>
      </tr>
    </ng-template>
    <ng-template #body let-book>
      <tr [pSelectableRow]="book">
        <td>
          <sup>{{book.title.supertitle}}</sup>
          {{book.title.title}}
          <sub>{{book.title.subtitle}}</sub>
        </td>
        <td>
          @if (book.lent) {
          <p-badge value="Prestado" severity="success" />
          }@else {
          <p-badge value="Disponible" severity="success" />
          }
        </td>
        <td>
          <p-button icon="pi pi-pencil" severity="secondary" [disabled]="!editable" aria-label="Editar"
            [attr.aria-disabled]="!editable" (click)="menu.toggle($event)" rounded text />
          <p-button icon="pi pi-trash" severity="danger" [disabled]="!editable" aria-label="Borrar"
            [attr.aria-disabled]="!editable" (click)="onConfirmDelete($event, book.number)" rounded text />
        </td>
      </tr>
    </ng-template>
  </p-table>
</p-panel>
<p-panel>
  <p-menu #menu [model]="editionMenu" [popup]="true" />
  <ng-template #icons>
    <p-button icon="pi pi-plus-circle" severity="secondary" routerLink="{{routerLink}}" [disabled]="!createPermission"
      aria-label="Nuevo libro" [attr.aria-disabled]="!createPermission" rounded text />
    <p-button icon="pi pi-file-excel" [disabled]="loadingExcel" (click)="downloadExcel()" aria-label="Descargar excel"
      [attr.aria-disabled]="loadingExcel" severity="secondary" rounded text />
  </ng-template>
  <select [disabled]="loading" class="form-select form-select-sm" aria-label="Filter person status"
    (change)="onChangeSource($event)">
    <option [selected]="source === 'games'" value="games">Juegos</option>
    <option [selected]="source === 'fiction'" value="fiction">Ficción</option>
  </select>
  <p-dataview #dv [value]="data.content" layout="grid" paginator="true" [rows]="data.size"
    [totalRecords]="data.totalElements" [first]="first" currentPageReportTemplate="Total: {totalRecords}">
    <ng-template #grid let-books>
      <div class="row">
        @for (book of books; track book.number) {
        <div class="col-sm-6 border">
          <div class="row">
            <div class="col-sm-6">
              <h2>
                @if (book.title.supertitle) {
                <sup>{{book.title.supertitle}}</sup>
                }
                {{book.title.title}}
                @if (book.title.subtitle) {
                <sub>{{book.title.subtitle}}</sub>
                }
                <span class="ps-1">
                  @if (book.lent) {
                  <p-badge value="Prestado" severity="warn" />
                  }@else {
                  <p-badge value="Disponible" severity="success" />
                  }
                </span>
                <span class="ps-1">
                  <p-badge [value]="book.language" severity="info" />
                </span>
              </h2>
            </div>
            <div class="col-sm-6">
              <div class="d-flex justify-content-end">
                <p-button icon="pi pi-pencil" severity="secondary" [disabled]="!editable" aria-label="Editar"
                  [attr.aria-disabled]="!editable" (click)="menu.toggle($event)" rounded text />
                <p-button icon="pi pi-trash" severity="danger" [disabled]="!editable" aria-label="Borrar"
                  [attr.aria-disabled]="!editable" (click)="onConfirmDelete($event, book.number)" rounded text />
              </div>
            </div>
          </div>
          <div>
            @if(book.gameSystem) {
            <span class="p3-1">
              <p-badge [value]="book.gameSystem.name" severity="info" />
            </span>
            }
            @if(book.bookType) {
            <span class="p3-1">
              <p-badge [value]="book.bookType.name" severity="info" />
            </span>
            }
          </div>
          <div class="row">
            <div class="col-sm-6">
              @if (book.isbn) {
              ISBN {{book.isbn}}
              }
            </div>
            <div class="col-sm-6">
              @if (book.publishDate && book.publishers.length > 0) {
              Publicado
              @if (book.publishDate) {
              el {{book.publishDate}}
              }
              @if (book.publishers.length > 0) {
              por {{ publishers(book) }}
              }
              }
            </div>
          </div>
          <div>
            @if (book.authors.length > 0) {
            Autores: {{ authors(book) }}
            }
          </div>
          <div class="d-flex justify-content-end">
            @if (book.donation) {
            <i>Donado el {{ book.donation?.date }} por {{ donors(book) }}</i>
            }
          </div>
        </div>
        }
      </div>
    </ng-template>
  </p-dataview>
</p-panel>