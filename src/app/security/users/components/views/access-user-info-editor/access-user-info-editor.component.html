<layout-article title="Editar usuario">
  <div appResponsiveShortColumns>
    <div class="card">
      <div class="card-header">
        <ul class="nav nav-tabs card-header-tabs">
          <li class="nav-item">
            <a class="nav-link" [class.active]="view === 'user'" aria-current="page" role="button"
              (click)="onChangeView('user')">Usuario</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [class.active]="view === 'status'" aria-current="page" role="button"
              (click)="onChangeView('status')">Estado</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [class.active]="view === 'roles'" aria-current="page" role="button"
              (click)="onChangeView('roles')">Roles</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" [class.active]="view === 'member'" aria-current="page" role="button"
              (click)="onChangeView('member')">Socio</a>
          </li>
        </ul>
      </div>
      <div class="card-body">
        <ng-container [ngSwitch]="view">
          <!-- User -->
          <ng-container *ngSwitchCase="'user'">
            <ng-container [ngSwitch]="editing">
              <!-- Form -->
              <ng-container *ngSwitchCase="true">
                <div class="card mb-1">
                  <div class="card-body">
                    <access-user-form [create]="false" [waiting]="waiting" [readonly]="!formEnabled" [data]="data"
                      [failures]="failures" [cancellable]="true" (save)="onSave($event)" (cancel)="onCancel()">
                    </access-user-form>
                  </div>
                </div>
              </ng-container>
              <!-- Info -->
              <ng-container *ngSwitchCase="false">
                <access-user-info [data]="data" [showMenu]="showMenu" [deletable]="deletable" [editable]="editable"
                  (delete)="onDelete()" (startEditing)="onStartEditing()"></access-user-info>
              </ng-container>
            </ng-container>
          </ng-container>
          <!-- Status -->
          <ng-container *ngSwitchCase="'status'">
            <access-user-status [data]="data"></access-user-status>
            <!-- Enable/disable button -->
            <div class="mb-1">
              <div class="card">
                <div class="card-body">
                  <div class="row">
                    <ng-template [ngIf]="!data.enabled">
                      <!-- Enable button -->
                      <div class="col-sm-2 d-grid gap-2">
                        <layout-waiting-button [waiting]="changingActive" [disabled]="!editEnabled" name="Enable"
                          data-bs-toggle="modal"
                          [attr.data-bs-target]="editEnabled ? '#enableModal' : ''">Activar</layout-waiting-button>
                      </div>
                    </ng-template>
                    <ng-template [ngIf]="data.enabled">
                      <!-- Disable button -->
                      <div class="col-sm-2 d-grid gap-2">
                        <layout-waiting-button [waiting]="changingActive" [disabled]="!editEnabled" name="Disable"
                          data-bs-toggle="modal"
                          [attr.data-bs-target]="editEnabled ? '#disableModal' : ''">Desactivar</layout-waiting-button>
                      </div>
                    </ng-template>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
          <!-- Roles -->
          <ng-container *ngSwitchCase="'roles'">
            <article class="p-4">
              <header>
                <h2 class="border-bottom">Roles</h2>
              </header>
              <!-- Roles -->
              <div class="mb-1">
                <div class="card">
                  <div class="card-body">
                    <access-user-roles-editor [editable]="editEnabled" [deletable]="deleteEnabled"
                      [username]="data.username" [waiting]="waiting" [waitingRolesSelection]="readingRoleSelection"
                      [roles]="data.roles" [rolesSelection]="rolesSelection" (add)="onAddRole($event)"
                      (remove)="onRemoveRole($event)"
                      (goToSelectionPage)="onGoToRoleSelectionPage($event)"></access-user-roles-editor>
                  </div>
                </div>
              </div>
            </article>
          </ng-container>
          <!-- Member -->
          <ng-container *ngSwitchCase="'member'">
            <article class="p-4">
              <header>
                <h2 class="border-bottom">Socio</h2>
              </header>
              <!-- Member -->
              <div class="mb-1">
                <div class="card">
                  <div class="card-body">
                    <access-user-member-editor [member]="member.name.fullName" [editable]="editable"
                      [waiting]="readingMember" [waitingMembersSelection]="readingMemberSelection"
                      [membersSelection]="membersSelection" (goToSelectionPage)="onGoToMemberSelectionPage($event)"
                      (selectMember)="onSelectMember($event)"></access-user-member-editor>
                  </div>
                </div>
              </div>
            </article>
          </ng-container>
        </ng-container>
      </div>
    </div>
  </div>
</layout-article>

<!-- Modal confirmation for disabling -->
<layout-modal name="disableModal" title="Desactivar usuario" acceptText="Desactivar" (accept)="onDisable()">
  <p>¿Está seguro de que quieres desactivar el usuario?</p>
</layout-modal>

<!-- Modal confirmation for enabling -->
<layout-modal name="enableModal" title="Activar usuario" acceptText="Activar" (accept)="onEnable()">
  <p>¿Está seguro de que quieres activar el usuario?</p>
</layout-modal>