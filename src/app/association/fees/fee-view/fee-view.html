<div class="p-4 space-y-6">
  <p-menu #feeCreationMenu [model]="creationItems" [popup]="true" />

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6 place-items-center">
    <p-card class="w-60">
      <div class="flex items-center space-x-4">
        <div class="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center">
          <i class="pi pi-user text-xl"></i>
        </div>
        <div>
          @if (loadingReport) {
          <p-skeleton />
          } @else {
          <p class="text-2xl font-semibold">{{report.paid}}</p>
          }
          <p class="uppercase text-gray-500 text-sm">Cuotas pagadas</p>
        </div>
      </div>
    </p-card>

    <p-card class="w-60">
      <div class="flex items-center space-x-4">
        <div class="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center">
          <i class="pi pi-user text-xl"></i>
        </div>
        <div>
          @if (loadingReport) {
          <p-skeleton />
          } @else {
          <p class="text-2xl font-semibold">{{report.unpaid}}</p>
          }
          <p class="uppercase text-gray-500 text-sm">Sin pagar</p>
        </div>
      </div>
    </p-card>
  </div>

  <div class="flex flex-wrap mb-3 items-center w-full space-x-2">
    @if (createable) {
    <div class="ml-auto space-x-2">
      <p-button icon="pi pi-plus-circle" (click)="feeCreationMenu.toggle($event)" [disabled]="!createable"
        aria-label="Nueva cuota" [attr.aria-disabled]="!createable" rounded />
    </div>
    }
  </div>

  <!-- Buttons -->
  <div class="flex flex-wrap mb-3 items-center w-full space-x-2">
    <assoc-member-status-selector [status]="activeFilter" (filter)="onChangeMemberStatus($event)" />
  </div>

  <!-- Fee Calendar Panel -->
  <div class="w-full">
    <p-panel class="shadow rounded-lg">

      <!-- Calendar -->
      <assoc-fee-calendar [year]="year" [range]="range" [loading]="loadingCalendar" [feeCalendar]="feeCalendar"
        (goToYear)="loadCalendar($event)" (selectFee)="onSelectFee($event)" />

    </p-panel>
  </div>

  <!-- Fee Info Dialog -->
  <p-dialog header="Cuota" [modal]="true" [(visible)]="showing" [style]="{ width: '50rem' }" class="rounded-lg"
    contentStyleClass="p-4 space-y-4">
    <assoc-fee-details [data]="selectedData" [loading]="loadingDetail" />

    <div class="flex space-x-2">
      <p-button icon="pi pi-pencil" severity="secondary" [disabled]="!editable" aria-label="Editar"
        [attr.aria-disabled]="!editable" (click)="onStartEditingView('edition')" rounded text class="!p-2" />

      <p-button icon="pi pi-trash" severity="danger" [disabled]="!deletable" aria-label="Borrar"
        [attr.aria-disabled]="!deletable" (click)="onDelete($event, selectedData)" rounded text class="!p-2" />
    </div>
  </p-dialog>

  <!-- Dialogs for Creation / Payment / Edition -->
  @switch (view) {

  @case('create') {
    <p-dialog header="Crear cuota sin pagar" [modal]="true" [(visible)]="editing" [style]="{ width: '50rem' }"
      class="rounded-lg">
      <assoc-member-select-stepper [getMemberSelection]="getMembers.bind(this)" (selectMember)="onSelectMember($event)">
        <assoc-fee-creation-form [loading]="loadingDetail" [failures]="failures" [member]="selectedMember"
          (save)="onCreateUnpaid($event)" />
      </assoc-member-select-stepper>
    </p-dialog>
  }

  @case('pay') {
    <p-dialog header="Pagar cuota" [modal]="true" [(visible)]="editing" [style]="{ width: '50rem' }" class="rounded-lg">
      <assoc-member-select-stepper [getMemberSelection]="getMembers.bind(this)" (selectMember)="onSelectMember($event)">
        <assoc-fee-payments-form [loading]="loadingDetail" [failures]="failures" [member]="selectedMember"
          (save)="onPay($event)" />
      </assoc-member-select-stepper>
    </p-dialog>
  }

  @case('edition') {
  <p-dialog header="Editar cuota" [modal]="true" [(visible)]="editing" [style]="{ width: '50rem' }" class="rounded-lg">
    <assoc-fee-edition-form [loading]="loadingDetail" [data]="selectedData" [failures]="failures"
      (save)="onUpdate($event)" />
  </p-dialog>
  }

  }
</div>